<!DOCTYPE html>
<html>
  <head>
	  <meta charset="UTF-8">
	  
	<title>httpcalltest</title>
	<script src="static/javascripts/d3.v3.min.js"></script>
	<script src="static/javascripts/topojson.v1.min.js"></script>
	<script src="static/javascripts/jquery.min.js"></script>
	<script src="static/javascripts/d3.tip.v0.6.3.js"></script>
    <script src="http://d3js.org/queue.v1.min.js"></script>
	<script src="static/javascripts/jquery-ui.min.js"></script>
	<link rel="stylesheet" href="static/stylesheets/jquery-ui.css" />
	<link rel="stylesheet" href="static/bootstrap-3.1.1-dist/css/bootstrap.min.css">
	<script src="static/javascripts/jquery-ui.min.js"></script>
	<link href="static/bootstrap-3.1.1-dist/css/bootstrap-glyphicons.css" rel="stylesheet">
	<link rel="stylesheet" href="//ajax.googleapis.com/ajax/libs/jqueryui/1.10.4/themes/smoothness/jquery-ui.css" />
	<link rel="stylesheet" type="text/css" href="style.css"> </style>
	
  <script type="text/javascript" src="//ajax.aspnetcdn.com/ajax/jquery.ui/1.8.10/jquery-ui.min.js"></script>
</head>
<body>

<script>
  var pub = {
    censusId:null,
    coordinates:null
  }
      d3.select("body").append("div").attr("id","coordinates").html("test")
      d3.select("body").append("div").attr("id","censusLabel").html("test")
      d3.select("body").append("div").attr("id","data").html("test")
  
  function getLocation() {
      if (navigator.geolocation) {
          navigator.geolocation.getCurrentPosition(showPosition);
      } else {
          x.innerHTML = "Geolocation is not supported by this browser.";
      }
  }

  function showPosition(position) {
     // var latlon = position.coords.latitude + "," + position.coords.longitude;  
    var lng = position.coords.longitude
    var lat = position.coords.latitude        
    d3.select("#coordinates").html("Lat:"+lat+"<br/>Lng:"+lng)
    
    var locationUrl = "https://data.fcc.gov/api/block/2010/find?format=jsonp&latitude="+lat+"&longitude="+lng   
    getJson(locationUrl,"jsonp","formatCensusIds")
  
  }

getLocation() 

var sampleLocation = [40.718914, -73.9547791]  
var sampleUrl_fcc = "https://data.fcc.gov/api/block/2010/find?format=jsonp&latitude=40.718914&longitude=-73.9547791"
var smapleUrl_census = "https://geocoding.geo.census.gov/geocoder/locations/onelineaddress?address=4600+Silver+Hill+Rd%2C+Suitland%2C+MD+20746&benchmark=9&format=json"

function getJson(url,type,callBack){
  $.ajax({
    url: url,
    dataType: type,
    jsonpCallback: callBack
  });
}


function formatCensusIds(json){
  d3.select("#censusLabel").html("Block: "+json.Block.FIPS+"<br/>County: "+json.County.FIPS+"<br/>State: "+json.State.FIPS) 
  pub.censusId = json.Block.FIPS
    console.log(pub.censusId.slice(0,-3))
  var tableName = "B01002"
  var geoid = "15000US"+pub.censusId.slice(0,-3)
  var censusReporter = "https://api.censusreporter.org/1.0/data/show/latest?table_ids="+tableName+"&geo_ids="+geoid
  $.getJSON( censusReporter, function( data ) {
    
    console.log(data)
    d3.select("#data").html(data.tables[tableName]["title"]+"</br>"
    +data.data[geoid][tableName]["estimate"][tableName+"001"]+"</br>"
    +data.data[geoid][tableName]["estimate"][tableName+"002"]+"</br>"
    +data.data[geoid][tableName]["estimate"][tableName+"003"]
  )
  });
}

//https://api.censusreporter.org/1.0/data/show/latest?table_ids=B01001&geo_ids=16000US5367000

function formatCensusData(json){
  console.log(json)
}




</script>

</body>
</html>
